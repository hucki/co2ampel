<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Mundwerk LogopÃ¤dische Praxis - CO2 Ampel</title>
</head>
<body>
  <div class="card">
    <h1 class="heading">Neumarkt</h1>
    <div id="temp-neumarkt" class="box temp">Lade Temperatur</div>
    <canvas id="co2-neumarkt"></canvas>
    <div id="co2-neumarkt-value"></div>
  </div>
  <div class="card">
    <h1 class="heading">StembergstraÃŸe</h1>
    <div id="temp-stemberg" class="box temp">Lade Temperatur</div>
    <canvas id="co2-stemberg"></canvas>
    <div id="co2-stemberg-value" class="box co2"></div>
  </div>
  <canvas id="foo" width="200" height="100"></canvas>
  <iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/1194242/charts/1?bgcolor=%23eeeeee&color=%23ff9000&days=1&dynamic=true&results=30&title=CO2+-+Wartezimmer+-+Arnsberg&type=line&yaxis=CO2+%28ppm%29"></iframe>
  <iframe width="450" height="260" style="border: 1px solid #cccccc;" src="https://thingspeak.com/channels/1194245/charts/1?bgcolor=%23eeeeee&color=%23ff9000&days=1&dynamic=true&results=30&title=CO2+-+Wartezimmer+-+Neheim&type=line&yaxis=CO2+%28ppm%29"></iframe>
  <script>
    let state = {
      1194242: {
        name: 'neumarkt',
        temp: 0,
        co2: 0,
        isLoading: true,
        updated_at: null,
        feeds: []
      },
      1194245: {
        name: 'stemberg',
        temp: 0,
        co2: 0,
        isLoading: true,
        updated_at: null,
        feeds: []
      }
    }


    const getData = () => {
      Object.keys(state).forEach(item => {
        fetch(`https://api.thingspeak.com/channels/${item}/feeds.json?results=30`)
          .then(res => res.json()
            .then(resParsed => {
              //console.log(resParsed.feeds[1])
              const feedLength = resParsed.feeds.length
              state[item].co2 = resParsed.feeds[feedLength-1].field1;
              state[item].temp = resParsed.feeds[feedLength-1].field2;
              state[item].isLoading = false;
              state[item].updated_at = resParsed.feeds[feedLength-1].created_at;
              state[item].feeds = resParsed.feeds;
              console.log(state[item].feeds);
              const tempElement = document.getElementById(`temp-${state[item].name}`)
              tempElement.innerHTML = `ðŸŒ¡ ${state[item].temp} Â°C`
              const co2Element = document.getElementById(`co2-${state[item].name}-value`)
              co2Element.innerHTML = `<h2>${state[item].co2} ppm</h2> (${state[item].updated_at})`
              //console.log(state);
            }));
      })
    }
    getData()
    setInterval(getData, 15000);
  </script>
</body>
</html>